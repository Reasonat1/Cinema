<?php

function my_utilities_init() {
   drupal_add_css(drupal_get_path('module', 'my_utilities') . '/my_utilities.css');
   drupal_add_js(drupal_get_path('module', 'my_utilities') . '/my_utilities.js');
   drupal_add_js(drupal_get_path('module', 'my_utilities') . '/atemay.js');
}
function my_utilities_form_alter(&$form, &$form_state, $form_id) {
   if($form_id == 'taxonomy_form_term'){
    $vocb_name = $form['#vocabulary']->machine_name;
     if($vocb_name == 'lobby'){
      $form['name']['#title'] = 'Lobby name';
      $form['description']['#title'] = 'Lobby description & teaser';
     }
   }
}
function _return_addthisevent_markup($node) {
  $output = '';
  if(isset($node->field_cm_event_time) && !empty($node->field_cm_event_time['und'][0]['value'])){
   $start   = date('d-m-Y', $node->field_cm_event_time['und'][0]['value']);
   $start_time = date('H:i:s', $node->field_cm_event_time['und'][0]['value']);
   $end     = date('d-m-Y', $node->field_cm_event_time['und'][0]['value2']) ? date('d-m-Y', $node->field_cm_event_time['und'][0]['value2']) : $start;
   $end_time = date('H:i:s', $node->field_cm_event_time['und'][0]['value2']);
   $summery   = !empty($node->title) ? $node->title : '';
   $description  = $node->field_cm_event_body['und'][0]['safe_summary'] ? $node->field_cm_event_body['und'][0]['safe_summary'] : $node->field_cm_event_body['und'][0]['safe_value']; 
   $owner   = user_load($node->uid);
   $text = t('Add to Calendar') . '
    <span class="_start">'.$start.' ' .$start_time.'</span>
    <span class="_start">'.$end.' ' .$end_time.'</span>
  <span class="_zonecode">40</span>
  <span class="_summary">'.$summery.'</span>
  <span class="_description">'.check_plain($description).'</span>
  <span class="_organizer">'.$owner->name.'</span>
  <span class="_organizer_email">'.$owner->mail.'</span>
  <span class="_all_day_event">false</span>
  <span class="_date_format">DD/MM/YYYY</span>';
  
   $output = l($text,url(current_path(), array('absolute' => TRUE)),array('html' => TRUE,'attributes' => array('class' => array('addthisevent'))));
   

  }  
  return $output;
}

function my_utilities_views_pre_render(&$view) {
  
  //remove current event from the future events view list. this has to be done here because we cant exclude the node argument from view as it is not only excluded but also used for limiting results.
  if($view->name == 'event_ct_view' && $view->current_display == 'panel_pane_5') {
	foreach($view->result as $key => &$result) {
		if($result->node_field_data_field_event_corresponding_ref_nid == $view->args[0]) {
			unset($view->result[$key]);			
		}		
	}
  }
	
	
}
/**
 * Implements hook_admin_paths().
 *//*
function my_utilities_admin_paths() {
  $paths['admin/config/mini-panels-ipe/*'] = FALSE;
  return $paths;
}*/
